<%- include partials/header.ejs %>
<body>
    <%- include partials/navbar.ejs %>
    <div class="container">
        <div class="card" id="formulario-venda">
            <div class="card-header">
                <h4 ALIGN="CENTER" class="text-black-50" style="text-transform: uppercase"> VENDA </h4>
            </div>
            <div class="card-body">
                <form method="post" action="/carrinho">
                    <label for="id">Digite o ID do Produto:</label>
                    <input type="number" onchange="myfunc()" id="id" name="idc" value=<%= idc%> min="1"  > <BR>
                    <label for="desc">Digite a Descrição do Produto </label>
                    <input type="text" id="desc" name="desc"> <br>
                    <script>
                        function myfunc(){
                            let idc= document.getElementById("id");
                            let idc2 = idc.value.toLowerCase();
                            let qtd= document.getElementById("qtd");
                            let val= document.getElementById("val");
                            let tbody=document.getElementById("tbody");
                            let tr=tbody.childNodes;
                            let td=tr.childNodes;
                            let find=false;

                            for (let i=1;i<tbody.childNodes.length;i=i+2){
                                tr=tbody.childNodes[i];
                                td=tr.childNodes;

                                let value = td[1].childNodes[0].nodeValue.toLowerCase();

                                if(parseInt(value)===parseInt(idc2)){
                                    find=true;
                                    let qtd2 = td[9].childNodes[0].nodeValue;
                                    let val2 = td[7].childNodes[0].nodeValue;

                                    qtd.max = parseInt(qtd2);
                                    val.value = parseInt(val2);

                                }
                                if(value.indexOf(idc2)===0){
                                    tr.style.display = "table-row";
                                }
                                else {
                                    tr.style.display = "none";
                                }
                            }

                            if(!find) {
                                let malu=document.getElementById('maluco');
                                let bot=document.getElementById('bot');
                                malu.className='alert alert-danger';
                                malu.role='alert';
                                malu.innerHTML='ID não encontrado'
                                malu.style='margin: 15px 0px 0px 0px';
                                bot.disabled=true;
                            }
                            else{
                                let malu=document.getElementById('maluco');
                                let bot=document.getElementById('bot');
                                malu.className='alert alert-success';
                                malu.role='alert';
                                malu.innerHTML='ID encontrado!'
                                malu.style='margin: 15px 0px 0px 0px';

                                bot.disabled=false;
                            }
                        }
                        document.getElementById("id").addEventListener("keyup", function (){
                            let idc= document.getElementById("id");
                            let idc2 = idc.value.toLowerCase();
                            let qtd= document.getElementById("qtd");
                            let val= document.getElementById("val");
                            let tbody=document.getElementById("tbody");
                            let tr=tbody.childNodes;
                            let td=tr.childNodes;
                            let find=false;

                            for (let i=1;i<tbody.childNodes.length;i=i+2){
                                tr=tbody.childNodes[i];
                                td=tr.childNodes;

                                let value = td[1].childNodes[0].nodeValue.toLowerCase();

                                if(parseInt(value)===parseInt(idc2)){
                                    find=true;
                                    let qtd2 = td[9].childNodes[0].nodeValue;
                                    let val2 = td[7].childNodes[0].nodeValue;

                                    qtd.max = parseInt(qtd2);
                                    val.value = parseInt(val2);

                                }
                                if(value.indexOf(idc2)===0){
                                    tr.style.display = "table-row";
                                }
                                else {
                                    tr.style.display = "none";
                                }
                            }

                            if(!find) {
                                let malu=document.getElementById('maluco');
                                let bot=document.getElementById('bot');
                                malu.className='alert alert-danger';
                                malu.role='alert';
                                malu.innerHTML='ID não encontrado'
                                malu.style='margin: 15px 0px 0px 0px';
                                bot.disabled=true;
                            }
                            else{
                                let malu=document.getElementById('maluco');
                                let bot=document.getElementById('bot');
                                malu.className='alert alert-success';
                                malu.role='alert';
                                malu.innerHTML='ID encontrado!'
                                malu.style='margin: 15px 0px 0px 0px';

                                bot.disabled=false;
                            }
                        })
                    </script>
                    <script>
                        document.getElementById("desc").addEventListener("keyup", function (){
                            let desc= document.getElementById("desc");
                            desc = desc.value.toLowerCase();
                            let idc4 = document.getElementById("id");
                            let qtd= document.getElementById("qtd");
                            let val= document.getElementById("val");
                            let tbody=document.getElementById("tbody");
                            let tr=tbody.childNodes;
                            let td=tr.childNodes;
                            let find=0;

                            for (let i=1;i<tbody.childNodes.length;i=i+2){
                                tr=tbody.childNodes[i];
                                td=tr.childNodes;
                                let value = td[3].childNodes[0].nodeValue.toLowerCase();

                                if(value.indexOf(desc)===0){
                                    if (find===0){
                                        let idc3 = td[1].childNodes[0].nodeValue;
                                        let qtd2 = td[9].childNodes[0].nodeValue;
                                        let val2 = td[7].childNodes[0].nodeValue;

                                        qtd.max=parseInt(qtd2);
                                        val.value = parseInt(val2);
                                        idc4.value = parseInt(idc3);
                                    }
                                    tr.style.display = "table-row";
                                    find = parseInt(find) + 1;
                                }
                                else {
                                    tr.style.display = "none";
                                }
                            }

                        })
                    </script>
                    <label for="qtd">Digite a quantidade vendida:</label>
                    <input type="number" id="qtd" name="qtd" value="1" max=<%= quant %> min="1"><br>
                    <label for="val">Digite o valor do Produto:</label>
                    <input type="number" id="val" name="val" min="0" value=<%= val1 %> > <br>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="radio" id="radio" value="1" checked>
                        <label class="form-check-label" for="radio">VENDER</label>
                    </div>
                    <div style="margin-bottom: 7px" class="form-check">
                        <input class="form-check-input" type="radio" name="radio" id="radio2" value="2">
                        <label class="form-check-label" for="radio2">REMOVER</label>
                    </div>
                    <input type="submit" id="bot" class="btn btn-outline-dark">
                    <div id='maluco'>
                    </div>
                </form>
            </div>
            <div id="scroll">
                <table class="table table-hover text-uppercase table-light table-bordered">
                    <thead class="thead-light">
                        <tr>
                            <th scope="col"> ID </th>
                            <th scope="col"> Descrição </th>
                            <th scope="col"> Tamanho </th>
                            <th scope="col"> Valor </th>
                            <th scope="col"> Quantidade </th>
                        </tr>
                    </thead>
                    <tbody id="tbody">
                        <% for(var i=0; i<results.length; i++) { %>
                            <%if(results[i].quantidade===0){%>
                                <%continue;%>
                            <%}%>
                            <tr>
                                <td scope="row"><%= results[i].ID %> </td>
                                <td><%= results[i].descricao %> </td>
                                <td><%= results[i].tamanho %> </td>
                                <td><%= results[i].valor %> </td>
                                <td><%= results[i].quantidade %> </td>
                            </tr>
                        <% } %>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</body>
<%- include partials/footer.ejs %>
